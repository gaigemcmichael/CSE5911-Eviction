<div class="docs-wrapper" data-controller="file-preview">
  <h1 class="docs-title">Upload a Document</h1>
  <p class="docs-subtitle">Max size: 25 MB. Supported types: PDF, Word, Excel, images, ZIP, media, etc.</p>

  <% flash.each do |k,v| %>
    <div class="flash <%= k == 'notice' ? 'is-notice' : 'is-alert' %>"><%= v %></div>
  <% end %>

  <div class="upload-card">
    <%= form_with url: documents_path, method: :post, html: { multipart: true, class: "upload-form" } do %>
      
      <label class="dropzone" for="file" role="button" tabindex="0" data-file-preview-target="dropzone">
        <span class="dz-icon" aria-hidden="true">⬆️</span>
        <span class="dz-title">Drag & drop your file here</span>
        <span class="dz-subtitle">or click to browse</span>

        <%= file_field_tag :file,
                id: "file",
                class: "sr-only",
                required: true,
                accept: ".pdf,.doc,.docx,.txt,.csv,.xlsx,.xls,.ppt,.pptx,.rtf,.png,.jpg,.jpeg,.gif,.bmp,.tiff,.heic,.zip,.rar,.7z,.json,.xml,.md,.mp3,.mp4,.wav,.mov,.avi",
                data: { "file-preview-target": "input", action: "change->file-preview#change" } %>
        </label>


      <!-- preview box + fallback -->
      
      <div class="filename" data-file-preview-target="fallback">No file selected</div>

      <div class="form-actions">
        <%= submit_tag "Upload", class: "btn btn-primary" %>
        <%= link_to "Cancel", documents_path, class: "btn btn-link" %>
      </div>
    <% end %>
  </div>
</div>

  <!-- `file-preview` Stimulus controller handles drag and drop and file preview -->
<%= javascript_tag nonce: true do %>
document.addEventListener("turbo:load", function () {
  const input = document.getElementById("file");
  const filename = document.querySelector(".filename");
  if (!input || !filename) return;

  input.addEventListener("change", function () {
    const f = this.files && this.files[0];
    filename.textContent = f ? f.name : "No file selected";
  });
});
<% end %>

