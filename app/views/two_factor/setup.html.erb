<div class="two-factor-setup">
  <h1>Set up two-factor authentication</h1>

  <p>Scan this QR code into your authenticator app (Google Authenticator, Authy, etc.)</p>

  <% if @qr_svg.present? %>
    <div class="qr-svg">
      <%= raw @qr_svg %>
    </div>
  <% else %>
    <% provisioning_uri = @provisioning_uri %>
    <img src="https://chart.googleapis.com/chart?cht=qr&chs=200x200&chl=<%= ERB::Util.url_encode(provisioning_uri) %>" alt="QR code" />
  <% end %>

  <p>Manual key: <strong><%= @secret %></strong></p>

  <p>After scanning, enter the 6-digit code here to verify and enable 2FA.</p>

  <% if flash[:error] %>
    <div class="flash is-alert"><%= flash[:error] %></div>
  <% end %>

  <%= form_with url: two_factor_enable_path, method: :post do %>
    <div class="field">
      <%= label_tag :otp_code, "Authentication code" %>
      <%= text_field_tag :otp_code, nil, autofocus: true, autocomplete: "one-time-code" %>
    </div>
    <div class="actions">
      <%= submit_tag "Enable 2FA", class: "btn btn-primary" %>
    </div>
  <% end %>
</div>
