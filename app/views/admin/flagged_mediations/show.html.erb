<div class="admin-mediation-details-container">
  <!-- Header -->
  <div class="page-header">
    <%= link_to admin_mediations_path, class: "back-link" do %>
      <i class="fa-solid fa-arrow-left"></i> Back to Dashboard
    <% end %>
    <h1>Mediation Details</h1>
  </div>

  <div class="details-grid">
    <!-- Left Column: Landlord & Mediator Actions -->
    <div class="details-column left-column">
      <!-- Landlord Card -->
      <div class="info-card">
        <div class="card-header">
          <h2><i class="fa-solid fa-house-user"></i> Landlord</h2>
        </div>
        <div class="card-body">
          <div class="info-row">
            <span class="label">Name</span>
            <span class="value"><%= @landlord.FName %> <%= @landlord.LName %></span>
          </div>
          <div class="info-row">
            <span class="label">Email</span>
            <span class="value"><%= @landlord.Email %></span>
          </div>
          <div class="info-row">
            <span class="label">Phone</span>
            <span class="value"><%= @landlord.PhoneNumber.presence || "N/A" %></span>
          </div>
          <% if @landlord.CompanyName.present? %>
            <div class="info-row">
              <span class="label">Company</span>
              <span class="value"><%= @landlord.CompanyName %></span>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Mediator Assignment Card -->
      <div class="info-card mediator-card">
        <div class="card-header">
          <h2><i class="fa-solid fa-gavel"></i> Mediator Assignment</h2>
        </div>
        <div class="card-body">
          <% if @mediator %>
            <div class="current-mediator">
              <span class="label">Current Mediator</span>
              <div class="mediator-name">
                <%= @mediator.FName %> <%= @mediator.LName %>
              </div>
            </div>
          <% else %>
            <div class="current-mediator">
              <span class="label">Current Status</span>
              <div class="mediator-name text-warning">
                <i class="fa-solid fa-circle-exclamation"></i> Unassigned
              </div>
            </div>
          <% end %>

          <div class="action-section">
            <h3>Reassign Case</h3>
            <%= form_with url: admin_reassign_mediator_path(@mediation), method: :patch, local: true do |f| %>
              <div class="form-group">
                <div class="select-wrapper">
                  <%= f.select :new_mediator_id, 
                      options_for_select(@eligible_mediators.map { |m| ["#{m.user.FName} #{m.user.LName} (#{m.ActiveMediations}/#{m.MediationCap} cases)", m.UserID] }), 
                      { prompt: "Select a mediator..." }, 
                      { class: "form-control" } 
                  %>
                  <i class="fa-solid fa-chevron-down"></i>
                </div>
              </div>
              <%= f.button type: "submit", class: "btn btn-primary" do %>
                <i class="fa-solid fa-user-check"></i> Assign Mediator
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column: Tenant Info & Screening -->
    <div class="details-column right-column">
      <!-- Tenant Card -->
      <div class="info-card">
        <div class="card-header">
          <h2><i class="fa-solid fa-user"></i> Tenant</h2>
        </div>
        <div class="card-body">
          <div class="info-row">
            <span class="label">Name</span>
            <span class="value"><%= @tenant.FName %> <%= @tenant.LName %></span>
          </div>
          <div class="info-row">
            <span class="label">Email</span>
            <span class="value"><%= @tenant.Email %></span>
          </div>
          <div class="info-row">
            <span class="label">Phone</span>
            <span class="value"><%= @tenant.PhoneNumber.presence || "N/A" %></span>
          </div>
          <div class="info-row">
            <span class="label">Address</span>
            <span class="value"><%= @tenant.TenantAddress.presence || "N/A" %></span>
          </div>

          <!-- Intake Data (New) -->
          <% if @mediation.intake_question %>
            <div class="screening-section">
              <h3>Intake Responses</h3>
              <div class="screening-grid">
                <div class="screening-item">
                  <span class="q-label">Reason for Mediation</span>
                  <span class="q-value"><%= @mediation.intake_question.Reason %></span>
                </div>
                <div class="screening-item">
                  <span class="q-label">Describe the Cause</span>
                  <span class="q-value"><%= @mediation.intake_question.DescribeCause.presence || "N/A" %></span>
                </div>
                <div class="screening-item">
                  <span class="q-label">Best Option</span>
                  <span class="q-value"><%= @mediation.intake_question.BestOption %></span>
                </div>
                <div class="screening-item">
                  <span class="q-label">Uses Section 8?</span>
                  <span class="q-value"><%= @mediation.intake_question.Section8 ? "Yes" : "No" %></span>
                </div>
                <div class="screening-item">
                  <span class="q-label">Money Owed</span>
                  <span class="q-value">$<%= @mediation.intake_question.MoneyOwed %></span>
                </div>
                <div class="screening-item">
                  <span class="q-label">Total or Monthly?</span>
                  <span class="q-value"><%= @mediation.intake_question.TotalCostOrMonthly ? "Monthly" : "Total" %></span>
                </div>
                <div class="screening-item">
                  <span class="q-label">Monthly Rent</span>
                  <span class="q-value">$<%= @mediation.intake_question.MonthlyRent || "N/A" %></span>
                </div>
                <div class="screening-item">
                  <span class="q-label">Date Due</span>
                  <span class="q-value"><%= @mediation.intake_question.DateDue&.strftime("%B %d, %Y") || "N/A" %></span>
                </div>
                <div class="screening-item">
                  <span class="q-label">Payable Today</span>
                  <span class="q-value"><%= @mediation.intake_question.PayableToday %></span>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
